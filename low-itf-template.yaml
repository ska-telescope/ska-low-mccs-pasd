---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: mccs-pasd-sa-ska-low-mccs-pasd
  namespace: ska-low-mccs
---
# Source: ska-low-mccs-pasd/templates/pasd_configuration_server.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: config-watcher-acc
  namespace: ska-low-mccs
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# Device Server configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: configurator
    function: deployment
    intent: enabling
    domain: self-configuration
data:
  configuration.json: |
    {
      "servers": {
        "pasd_device_server" : {
          "fieldstation-itf1": {
            "MccsFieldStation": {
              "low-mccs/fieldstation/itf1": {
                "properties": {
                  "ConfigurationHost": [
                    "pasd-configuration-service"
                    ],
                  "ConfigurationPort": [
                    "8081"
                    ],
                  "FndhFQDN": [
                    "low-mccs/fndh/itf1"
                    ],
                  "SmartBoxFQDNs": [
                    "low-mccs/smartbox/itf1-sb01",
                    "low-mccs/smartbox/itf1-sb19"
                    ],
                  "StationName": [
                    "itf1"
                    ]
                }
              }
            }
          },
          "fieldstation-itf2": {
            "MccsFieldStation": {
              "low-mccs/fieldstation/itf2": {
                "properties": {
                  "ConfigurationHost": [
                    "pasd-configuration-service"
                    ],
                  "ConfigurationPort": [
                    "8081"
                    ],
                  "FndhFQDN": [
                    "low-mccs/fndh/itf2"
                    ],
                  "SmartBoxFQDNs": [
                    "low-mccs/smartbox/itf2-sb02",
                    "low-mccs/smartbox/itf2-sb11"
                    ],
                  "StationName": [
                    "itf2"
                    ]
                }
              }
            }
          },
          "fndh-itf1": {
            "MccsFNDH": {
              "low-mccs/fndh/itf1": {
                "properties": {
                  "LoggingLevelDefault": [
                    "5"
                    ],
                  "ParentTRL": [
                    "low-mccs/fieldstation/itf1"
                    ],
                  "PasdFQDN": [
                    "low-mccs/pasdbus/itf1"
                    ]
                }
              }
            }
          },
          "fndh-itf2": {
            "MccsFNDH": {
              "low-mccs/fndh/itf2": {
                "properties": {
                  "LoggingLevelDefault": [
                    "5"
                    ],
                  "ParentTRL": [
                    "low-mccs/fieldstation/itf2"
                    ],
                  "PasdFQDN": [
                    "low-mccs/pasdbus/itf2"
                    ]
                }
              }
            }
          },
          "pasdbus-itf1": {
            "MccsPasdBus": {
              "low-mccs/pasdbus/itf1": {
                "properties": {
                  "AvailableSmartboxes": [
                    "1",
                    "19"
                    ],
                  "Host": [
                    "10.135.155.50"
                    ],
                  "LoggingLevelDefault": [
                    "5"
                    ],
                  "ParentTRL": [
                    "low-mccs/fieldstation/itf1"
                    ],
                  "Port": [
                    "5000"
                    ],
                  "Timeout": [
                    "10"
                    ]
                }
              }
            }
          },
          "pasdbus-itf2": {
            "MccsPasdBus": {
              "low-mccs/pasdbus/itf2": {
                "properties": {
                  "AvailableSmartboxes": [
                    "2",
                    "11"
                    ],
                  "Host": [
                    "10.135.155.51"
                    ],
                  "LoggingLevelDefault": [
                    "5"
                    ],
                  "ParentTRL": [
                    "low-mccs/fieldstation/itf2"
                    ],
                  "Port": [
                    "5000"
                    ],
                  "Timeout": [
                    "10"
                    ]
                }
              }
            }
          },
          "smartbox-itf1-sb01": {
            "MccsSmartBox": {
              "low-mccs/smartbox/itf1-sb01": {
                "properties": {
                  "FieldStationName": [
                    "low-mccs/fieldstation/itf1"
                    ],
                  "FndhFQDN": [
                    "low-mccs/fndh/itf1"
                    ],
                  "LoggingLevelDefault": [
                    "5"
                    ],
                  "ParentTRL": [
                    "low-mccs/fieldstation/itf1"
                    ],
                  "PasdFQDN": [
                    "low-mccs/pasdbus/itf1"
                    ],
                  "SmartboxNumber": [
                    "1"
                    ]
                }
              }
            }
          },
          "smartbox-itf1-sb19": {
            "MccsSmartBox": {
              "low-mccs/smartbox/itf1-sb19": {
                "properties": {
                  "FieldStationName": [
                    "low-mccs/fieldstation/itf1"
                    ],
                  "FndhFQDN": [
                    "low-mccs/fndh/itf1"
                    ],
                  "LoggingLevelDefault": [
                    "5"
                    ],
                  "ParentTRL": [
                    "low-mccs/fieldstation/itf1"
                    ],
                  "PasdFQDN": [
                    "low-mccs/pasdbus/itf1"
                    ],
                  "SmartboxNumber": [
                    "19"
                    ]
                }
              }
            }
          },
          "smartbox-itf2-sb02": {
            "MccsSmartBox": {
              "low-mccs/smartbox/itf2-sb02": {
                "properties": {
                  "FieldStationName": [
                    "low-mccs/fieldstation/itf2"
                    ],
                  "FndhFQDN": [
                    "low-mccs/fndh/itf2"
                    ],
                  "LoggingLevelDefault": [
                    "5"
                    ],
                  "ParentTRL": [
                    "low-mccs/fieldstation/itf2"
                    ],
                  "PasdFQDN": [
                    "low-mccs/pasdbus/itf2"
                    ],
                  "SmartboxNumber": [
                    "2"
                    ]
                }
              }
            }
          },
          "smartbox-itf2-sb11": {
            "MccsSmartBox": {
              "low-mccs/smartbox/itf2-sb11": {
                "properties": {
                  "FieldStationName": [
                    "low-mccs/fieldstation/itf2"
                    ],
                  "FndhFQDN": [
                    "low-mccs/fndh/itf2"
                    ],
                  "LoggingLevelDefault": [
                    "5"
                    ],
                  "ParentTRL": [
                    "low-mccs/fieldstation/itf2"
                    ],
                  "PasdFQDN": [
                    "low-mccs/pasdbus/itf2"
                    ],
                  "SmartboxNumber": [
                    "11"
                    ]
                }
              }
            }
          }
        }
      }
    }
  bootstrap.sh: |
    #/bin/sh
    json2tango -w -a -u data/configuration.json
    rc=$?
    if [ $rc -eq 0 ]; then
      echo "finished normally."
      exit 0
    else
      if [ $rc -eq 2 ]; then
        echo "finished with an update."
        exit 0
      else
        echo "finished with an ERROR."
        exit $rc
      fi
    fi
  pasd_device_server.py: |
    
    #!/usr/bin/env python
    
    import importlib
    import importlib.util
    from tango.server import run
    
    classes = []
    
    def main(args=None, **kwargs):
      
      return run(classes=(classes), args=args, **kwargs)
    
    if __name__ == '__main__':
        main()
---
# Source: ska-low-mccs-pasd/templates/pasd_configuration.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: pasd-configuration-itf1
  namespace: ska-low-mccs
  labels:
    platform_spec: pasd
    station: itf1
    app: ska-low-mccs-pasd
data:
  pasd_configuration.yaml: |
    antennas:
      sb01-01:
        masked: false
        smartbox: sb01
        smartbox_port: 3
      sb01-02:
        masked: false
        smartbox: sb01
        smartbox_port: 2
      sb19-01:
        masked: false
        smartbox: sb19
        smartbox_port: 1
      sb19-02:
        masked: false
        smartbox: sb19
        smartbox_port: 2
    pasd:
      smartboxes:
        sb01:
          fndh_port: 1
        sb19:
          fndh_port: 19
---
# Source: ska-low-mccs-pasd/templates/pasd_configuration.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: pasd-configuration-itf2
  namespace: ska-low-mccs
  labels:
    platform_spec: pasd
    station: itf2
    app: ska-low-mccs-pasd
data:
  pasd_configuration.yaml: |
    antennas:
      sb02-01:
        masked: false
        smartbox: sb02
        smartbox_port: 1
      sb02-02:
        masked: false
        smartbox: sb02
        smartbox_port: 2
      sb11-03:
        masked: false
        smartbox: sb11
        smartbox_port: 3
      sb11-04:
        masked: false
        smartbox: sb11
        smartbox_port: 4
    pasd:
      smartboxes:
        sb02:
          fndh_port: 2
        sb11:
          fndh_port: 11
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: mccs-pasd-role-ska-low-mccs-pasd
  namespace: ska-low-mccs
rules:
- apiGroups: ["batch"]
  resources: ["jobs"]
  verbs: ["list", "get", "watch"]
---
# Source: ska-low-mccs-pasd/templates/pasd_configuration_server.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: config-watcher-role
  namespace: ska-low-mccs
rules:
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["get", "list"]
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: mccs-pasd-role-bind-ska-low-mccs-pasd
  namespace: ska-low-mccs
subjects:
- kind: ServiceAccount
  name: mccs-pasd-sa-ska-low-mccs-pasd
  namespace: ska-low-mccs
roleRef:
  kind: Role
  name: mccs-pasd-role-ska-low-mccs-pasd
  apiGroup: rbac.authorization.k8s.io
---
# Source: ska-low-mccs-pasd/templates/pasd_configuration_server.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: config-watcher-rolebind
  namespace: ska-low-mccs
roleRef:
  kind: Role
  name: config-watcher-role
  apiGroup: rbac.authorization.k8s.io
subjects:
- kind: ServiceAccount
  name: config-watcher-acc
  namespace: ska-low-mccs
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
---
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-fieldstation-itf1
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-fieldstation-itf1
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: LoadBalancer
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-fieldstation-itf1
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-fieldstation-itf2
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-fieldstation-itf2
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: LoadBalancer
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-fieldstation-itf2
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-fndh-itf1
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-fndh-itf1
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: ClusterIP
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-fndh-itf1
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-fndh-itf2
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-fndh-itf2
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: ClusterIP
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-fndh-itf2
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-pasdbus-itf1
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-pasdbus-itf1
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: ClusterIP
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-pasdbus-itf1
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-pasdbus-itf2
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-pasdbus-itf2
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: ClusterIP
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-pasdbus-itf2
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-smartbox-itf1-sb01
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-smartbox-itf1-sb01
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: ClusterIP
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-smartbox-itf1-sb01
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-smartbox-itf1-sb19
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-smartbox-itf1-sb19
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: ClusterIP
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-smartbox-itf1-sb19
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-smartbox-itf2-sb02
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-smartbox-itf2-sb02
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: ClusterIP
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-smartbox-itf2-sb02
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# one k8s service per instance
apiVersion: v1
kind: Service
metadata:
  name: mccs-pasd-smartbox-itf2-sb11
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-smartbox-itf2-sb11
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  type: ClusterIP
  ports:
  - name: tango-server
    port: 45450
    targetPort: 45450
  - name: tango-heartbeat
    port: 45460
    targetPort: 45460
  - name: tango-event
    port: 45470
    targetPort: 45470
  selector:
    subsystem: mccs
    component: mccs-pasd-smartbox-itf2-sb11
---
# Source: ska-low-mccs-pasd/templates/pasd_configuration_server.yaml
apiVersion: v1
kind: Service
metadata:
  name: pasd-configuration-service
  namespace: ska-low-mccs
  labels:
    component: pasd-configuration-service-low-itf
spec:
  ports:
    - name: http
      protocol: TCP
      port: 8081
  type: ClusterIP
  selector:
    component: pasd-configuration-service-low-itf
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-fieldstation-itf1
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-fieldstation-itf1
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-fieldstation-itf1
      subsystem: mccs
  serviceName: mccs-pasd-fieldstation-itf1
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-fieldstation-itf1
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "fieldstation-itf1"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-fieldstation-itf1.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-fieldstation-itf2
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-fieldstation-itf2
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-fieldstation-itf2
      subsystem: mccs
  serviceName: mccs-pasd-fieldstation-itf2
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-fieldstation-itf2
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "fieldstation-itf2"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-fieldstation-itf2.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-fndh-itf1
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-fndh-itf1
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-fndh-itf1
      subsystem: mccs
  serviceName: mccs-pasd-fndh-itf1
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-fndh-itf1
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000

      - name: check-dependencies-1
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - low-mccs/pasdbus/itf1
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "fndh-itf1"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-fndh-itf1.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-fndh-itf2
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-fndh-itf2
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-fndh-itf2
      subsystem: mccs
  serviceName: mccs-pasd-fndh-itf2
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-fndh-itf2
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000

      - name: check-dependencies-1
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - low-mccs/pasdbus/itf2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "fndh-itf2"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-fndh-itf2.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-pasdbus-itf1
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-pasdbus-itf1
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-pasdbus-itf1
      subsystem: mccs
  serviceName: mccs-pasd-pasdbus-itf1
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-pasdbus-itf1
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "pasdbus-itf1"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-pasdbus-itf1.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-pasdbus-itf2
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-pasdbus-itf2
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-pasdbus-itf2
      subsystem: mccs
  serviceName: mccs-pasd-pasdbus-itf2
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-pasdbus-itf2
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "pasdbus-itf2"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-pasdbus-itf2.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-smartbox-itf1-sb01
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-smartbox-itf1-sb01
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-smartbox-itf1-sb01
      subsystem: mccs
  serviceName: mccs-pasd-smartbox-itf1-sb01
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-smartbox-itf1-sb01
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000

      - name: check-dependencies-1
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - low-mccs/pasdbus/itf1
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "smartbox-itf1-sb01"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-smartbox-itf1-sb01.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-smartbox-itf1-sb19
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-smartbox-itf1-sb19
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-smartbox-itf1-sb19
      subsystem: mccs
  serviceName: mccs-pasd-smartbox-itf1-sb19
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-smartbox-itf1-sb19
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000

      - name: check-dependencies-1
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - low-mccs/pasdbus/itf1
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "smartbox-itf1-sb19"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-smartbox-itf1-sb19.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-smartbox-itf2-sb02
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-smartbox-itf2-sb02
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-smartbox-itf2-sb02
      subsystem: mccs
  serviceName: mccs-pasd-smartbox-itf2-sb02
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-smartbox-itf2-sb02
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000

      - name: check-dependencies-1
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - low-mccs/pasdbus/itf2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "smartbox-itf2-sb02"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-smartbox-itf2-sb02.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mccs-pasd-smartbox-itf2-sb11
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: mccs-pasd-smartbox-itf2-sb11
    function: ska-low-mccs-pasd
    domain: low
    subsystem: mccs

spec:
  selector:
    matchLabels:
      component: mccs-pasd-smartbox-itf2-sb11
      subsystem: mccs
  serviceName: mccs-pasd-smartbox-itf2-sb11
  replicas: 1
  template:
    metadata:
      labels:
        component: mccs-pasd-smartbox-itf2-sb11
        function: ska-low-mccs-pasd
        domain: low
        subsystem: mccs
        app: ska-low-mccs-pasd
    
    spec:
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
        
      serviceAccountName: mccs-pasd-sa-ska-low-mccs-pasd
      initContainers:
      - name: wait-for-configuration
        image: "bitnami/kubectl:latest"
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - kubectl wait job --for=jsonpath='{.status.succeeded}'=1 mccs-pasd-ska-low-mccs-pasd-config --timeout=120s || ( ! kubectl get job mccs-pasd-ska-low-mccs-pasd-config ); echo $?

      - name: check-dependencies-0
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000

      - name: check-dependencies-1
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - tango_admin
          - --ping-device
          - low-mccs/pasdbus/itf2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: device-server
        image: "artefact.skao.int/ska-low-mccs-pasd:0.16.1"
        imagePullPolicy: IfNotPresent
        command:
          - retry
          - --max=60
          - --
          - pasd_device_server
          - "smartbox-itf2-sb11"
          - -ORBendPoint
          - giop:tcp::$(TANGO_SERVER_PORT)
          - -ORBendPointPublish
          - giop:tcp:$(TANGO_SERVER_PUBLISH_HOSTNAME):$(TANGO_SERVER_PORT)
        ports:
        - containerPort: 45450
          name: tango-server
        - containerPort: 45460
          name: tango-heartbeat
        - containerPort: 45470
          name: tango-event
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
          
        livenessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 45450
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 3
          successThreshold: 1
          failureThreshold: 3
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        - name: TANGO_SERVER_PORT
          value: "45450"
        - name: TANGO_ZMQ_HEARTBEAT_PORT
          value: "45460"
        - name: TANGO_ZMQ_EVENT_PORT
          value: "45470"
        - name: TANGO_SERVER_PUBLISH_HOSTNAME
          value: mccs-pasd-smartbox-itf2-sb11.ska-low-mccs.svc.lowitf.internal.skao.int
        resources:
          requests:
            cpu: 20m
            memory: 50Mi
---
# Source: ska-low-mccs-pasd/templates/pasd_configuration_server.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: pasd-configuration-service
  namespace: ska-low-mccs
  labels:
    component: pasd-configuration-service-low-itf
spec:
  selector:
    matchLabels:
      component: pasd-configuration-service-low-itf
  replicas: 1
  serviceName: pasd-configuration-service-low-itf
  template:
    metadata:
      labels:
        component: pasd-configuration-service-low-itf
    spec:
      serviceAccountName: config-watcher-acc
      containers:
      - name: pasd-configuration-service
        image: artefact.skao.int/ska-low-mccs-pasd:0.16.1
        imagePullPolicy: IfNotPresent
        command: 
          - "PasdConfigurationServer"
        env:
          - name: NAMESPACE
            value: ska-low-mccs
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
---
# run once Job for loading Device Server config
apiVersion: batch/v1
kind: Job
metadata:
  name: mccs-pasd-ska-low-mccs-pasd-config
  namespace: ska-low-mccs
  labels:
    app: ska-low-mccs-pasd
    component: configurator
    function: deployment
    intent: enabling
    domain: self-configuration

spec:
  ttlSecondsAfterFinished: 3600
  template:
    spec:
      initContainers:
      - name: check-databaseds-ready
        image: artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1
        imagePullPolicy: IfNotPresent
        command:
          - sh
          - -c
        args:
          - retry
          - --max=60
          - --
          - tango_admin
          - --check-device
          - sys/database/2
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
      containers:
      - name: dsconfig
        image: "artefact.skao.int/ska-tango-images-tango-dsconfig:1.5.1"
        imagePullPolicy: IfNotPresent
        command: # exit code 2 is CONFIG_APPLIED - https://github.com/MaxIV-KitsControls/lib-maxiv-dsconfig/blob/master/dsconfig/utils.py#L11 !!!! this should not be an error !!!!
          - retry
          - --max=60
          - --
          - sh
          - data/bootstrap.sh
        env:
        - name: TANGO_HOST
          value: tango-databaseds:10000
        volumeMounts:
          - name: configuration
            mountPath: data
            readOnly: true
      volumes:
        - name: configuration
          configMap:
            name: mccs-pasd-ska-low-mccs-pasd-dsconfig-json
      restartPolicy: Never
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
# if (.deviceserver.secrets)
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has
---
# Source: ska-low-mccs-pasd/charts/ska-tango-devices/templates/deviceservers.yaml
## if has

 # range instances

